<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div>
        <input type="hidden" id="id">
        <label for="name">Name </label><input type="text" id="name"><br>
        <label for="email">Email </label><input type="text" id="email"><br>
        <label for="phone">Phone </label><input type="text" id="phone"><br>
        <button onclick="createOrEdit()">send</button><br><br>
    </div>

    <table border="1">
        <thead>
            <tr>
                <th>Delete</th>
                <th>Id</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody id="myTable"></tbody>
    </table>


    <script>
        //Data 
        let contacts = JSON.parse(localStorage.getItem('contacts'));

        if (contacts == null) {
            localStorage.setItem('contacts', JSON.stringify([]));
        }
        if (contacts.length == 0) {
            localStorage.setItem('nextID', JSON.stringify(1));
        }
        //console.log(arr[0].name);

        //JSON.stringify(); // לןקח קוד והופך לג'ייסון    
        //JSON.parse(); // עושה את הפעולה ההפוכה 
        //setItem(); // שם בתוך הלוכל סטורג' 
        //getItem();// לוקח מתוך הלוקכל סטורג

        //read
        function creatTable(data) {
            let txt = "";
            for (obj of data) {
                txt += "<tr>";
                txt += `<td><button onclick="deleteContact(${obj.id})">Delete</button></td>`
                for (key in obj) {
                    txt += `<td>${obj[key]}</td>`;
                }
                txt += `<td><button onclick = "editContact(${obj.id})"">Edit</button></td>`
                txt += "</tr>";
            }
            document.getElementById("myTable").innerHTML = txt;
        }

        //create
        function addContact() {
            let id = JSON.parse(localStorage.getItem('nextID'));
            let name = document.getElementById("name").value;
            let email = document.getElementById("email").value;
            let phone = document.getElementById("phone").value;

            let obj = { id, name, email, phone };
            contacts.push(obj);
            localStorage.setItem('contacts', JSON.stringify(contacts));
            creatTable(contacts);
            document.getElementById("name").value = "";
            document.getElementById("email").value = "";
            document.getElementById("phone").value = "";
            localStorage.setItem('nextID',JSON.stringify(id+1));
            nextID++;
        }

        //Delete
        function deleteContact(id){
            contacts = JSON.parse(localStorage.getItem('contacts'));
            contacts = contacts.filter(obj=>obj.id != id);
            localStorage.setItem('contacts',JSON.stringify(contacts));
            creatTable(contacts);
        }

         //Update
        function editContact(id){
            contacts = JSON.parse(localStorage.getItem('contacts'));
            let obj =contacts.find(o => o.id === id);
                document.getElementById("id").value = obj.id;
                document.getElementById("name").value = obj.name;
                document.getElementById("email").value = obj.email;
                document.getElementById("phone").value = obj.phone;            
        }

        function realEdit(){
            let id = document.getElementById("id").value;
            let name = document.getElementById("name").value;
            let email = document.getElementById("email").value;
            let phone = document.getElementById("phone").value;
            let obj = contacts.find(o=>o.id == id);
            obj.name = name;
            obj.email = email;
            obj.phone = phone;
            localStorage.setItem('contacts',JSON.stringify(contacts));
            creatTable(contacts);
        }
        
        //selector
        function createOrEdit(){
            let id = document.getElementById("id").value;
            if(id){
                realEdit();
            }else{
                addContact();
            }
        }
        creatTable(contacts);
    </script>
</body>

</html>